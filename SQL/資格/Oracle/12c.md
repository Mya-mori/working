# 復習

1.　FOREIGN KEY制約
親表として指定された表は、参照されている行がない場合でも削除できなくなります。親表を削除する場合は、参照している子表を先に削除しなければなりません。

2.　UNIQUE制約
重複禁止で, 定義されている列にNULL値を格納できる

3.　FOREIGN KEY制約
主キーもしくは一意キーの列の値かNULL値を格納できる

4.　TRIM関数
引数で指定された文字列の前後にある削除文字を取り除いた文字列を返す

```sql
　TRIM([LEADING | TRAILING | BOTH] [削除文字] FROM 文字列)
or
　TRIM(文字列)
```

※ LEADING,TRAILING,BOTHを省略した場合は、文字列の前後の削除文字が取り除かれます。
・LEADING：先頭の削除文字を取り除く
・TRAILING：末尾の削除文字を取り除く
・BOTH：前後の削除文字を取り除く（デフォルト）
※ 削除文字には任意の1文字を指定できますが、文字列は指定できません

5.　検索

```sql
WHERE prod_name LIKE q'(%HITSW_%'s%)' ESCAPE 'W';
-- ここではエスケープ文字として「W」を指定していますので、「W」の直後のワイルドカードは通常のリテラルとして扱われます。
```

```sql
WHERE prod_name LIKE '%HITSW_%''s%' ESCAPE 'W';
-- ここではエスケープ文字として「W」を指定していますので、「W」の直後のワイルドカードは通常のリテラルとして扱われます。
```

- 文字パターンには、任意の1文字と一致する「_」や、0文字以上の任意の文字列と一致する「%」といった、ワイルドカードを利用できます

6.　データ型
VARCHAR2型はデータ長の省略ができないため、エラーとなります

7.　抽出

```sql
SELECT
    SUBSTR(INITCAP(name), 1, 2) || REPLACE(startdate, '-') "Code"
FROM
    prod WHERE name IS NOT NULL;
```

- SUBSTR(文字列, m[, n])
文字列のm番目からn文字分の文字列を返す

- REPLACE(文字列, 変更前文字列 [, 変更後文字列])
変更後文字列が省略された場合は、文字列から変更前文字列を削除した文字列を返す

- INITCAP(文字列)
先頭の単語を大文字にする. 2文字目以降は小文字にする.

- HAVINGの指定
  - SELECT文にWHERE句、GROUP BY句、HAVING句を同時に指定する場合は、WHERE句、GROUP BY句、HAVING句またはWHERE句、HAVING句、GROUP BY句の順に指定

  - HAVING句にはグループ関数の他、列を指定することもできますが、指定できる列はGROUP BY句で指定された列のみ

8.　DML(データ操作言語)

- スキーマ・オブジェクトのデータにアクセスし変更や削除など
  - データの更新(UPDATE, DELETE)
  - SELECT, INSERT

9.　NLV
  - NLV
第1引数の値がNULL値の場合は第2引数の値を返し、第1引数の値がNULL値以外の場合はそのまま第1引数の値を返す.同じデータ型である必要がある.

  ```sql
   NLV(AAA, BBB)
  ```

  - NLV2(AAA, BBB, CCC)
NVL2関数は、第1引数の値がNULL値以外の場合は第2引数の値を返し、第1引数の値がNULL値の場合は第3引数の値を返す.第3引数は第2引数と同じデータ型である必要があるが, 第1引数とは異なるデータ型でも良い

  ```sql
   NLV2(AAA, BBB, CCC)
   -- AAAがNULL以外 → BBB
   -- AAAがNULL以外 → CCC
  ```

10.　UPDATE

```sql
UPDATE employees
　SET (salary, commission)
　　= (SELECT salary * 1.2, commission + 200000
　　　　FROM employees
　　　　WHERE employee_id = 1010)
WHERE department_id = 5;
--------------------------------------------
UPDATE employees
    SET salary = (SELECT salary * 1.2 FROM employees WHERE employee_id = 1010),
        commission = (SELECT commission + 200000 FROM employeesWHERE employee_id = 1010)
WHERE department_id = 5;
```

11.　制約
制約は列レベル、表レベルで定義することができます。制約を定義する場合は、次の事項に注意します。

- CONSTRAINT 制約名は省略することができる
- CONSTRAINT 制約名を省略した場合は、「SYS_Cn」という制約名となる（nには一意の番号が振られる）
- 1つの列に複数の列レベル制約を定義する場合は、スペースで区切って定義する
　　例) 列名 データ型 [[CONSTRAINT 制約名1] 制約の種類] [[CONSTRAINT 制約名2] 制約の種類]
- 1つの表に複数の表レベル制約を定義する場合は、カンマで区切って定義する
- 列レベル制約と表レベル制約では機能に違いはない
- 列レベル制約と表レベル制約は1つの表で同時に指定できる
- 複数の列の組み合わせに対して制約を定義する場合は、表レベル制約でのみ定義できる
- NOT NULL制約は列レベルでのみ定義できる

